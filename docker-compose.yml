services:
  siteflow:
    build: .
    ports:
      - "4000:3000"
    environment:
      PORT: "3000"
      NODE_ENV: "production"
      AUTH_USER: "siteflow"
      AUTH_PASS: "Flow@2025!"
      SESSION_SECRET: "siteflow-secret-key-2025"
      PUPPETEER_EXECUTABLE_PATH: "/usr/bin/google-chrome-stable"
      SESSION_DB_PATH: "/tmp/sessions.db"
      SCAN_DB_PATH: "/tmp/sitemap-monitor.db"
    volumes:
      - ./data:/app/data
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:3000/health').then(r => process.exit(r.ok ? 0 : 1)).catch(() => process.exit(1))"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s
    restart: unless-stopped
